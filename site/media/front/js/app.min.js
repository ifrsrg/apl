$(document).ready(function() {

	var BASE_URL = __live+"/";



	$('.gallery-carousel').carouFredSel({
			infinite:false,
			circular:false,		
	    items               : 1,
			auto						    : false,  
			width              : 940,      
			height              : 468,      
	    scroll : {
	        items           : 1,
	        pauseOnHover    : true,
					onBefore : function( data ) {
		            console.log($( data.items.visible ).attr('data-index'));

		            $('.gallery-thumb-carousel li').each(function(){

		            	if($( data.items.visible ).attr('data-index') == $(this).attr('data-index'))
		            	{
		            		$('.gallery-thumb-carousel li').removeClass('selected');
		            		$(this).addClass('selected');

			            	$('.gallery-thumb-carousel').trigger('slideToPage', parseInt($(data.items.visible).attr('data-page')-1));
		            	}

		            });
		      }	        
	    },
			prev	: {	
				button	: ".gallery-carousel-prev",
				key		: "left"
			},
			next	: { 
				button	: ".gallery-carousel-next",
				key		: "right"
			}

	});

	$('.gallery-thumb-carousel').carouFredSel({
			infinite:false,
			circular:false,
	    items               : 8,
			auto						    : false,  
			width              : 940,
			height              : 72,      
	    scroll : {
	        items           : 8,
	        pauseOnHover    : true
	    }
	});

	$('.gallery-thumb-carousel li').on('click',function(e){
		$('.gallery-thumb-carousel li').removeClass('selected');
		$(this).addClass('selected');
		$('.gallery-carousel').trigger('slideToPage', parseInt($(this).attr('data-index')));
	});
	
	$('.conceitual-carousel').carouFredSel({
	    items               : 1,
			auto						    : true,        
	    scroll : {
	        items           : 1,
	        pauseOnHover    : true
	    },
		height:400,
	    pagination  : ".conceitual-carousel-pagination"

	}); 

	$('.affiliates-carousel').carouFredSel({
	    items               : 4,
			auto						    : false,        
	    scroll : {
	        items           : 1,
	        pauseOnHover    : true
	    },
			prev	: {	
				button	: ".affiliates-carousel-prev",
				key		: "left"
			},
			next	: { 
				button	: ".affiliates-carousel-next",
				key		: "right"
			}

	});
	
	$('.fornecedores-carousel').carouFredSel({
	    items               : 4,
			auto						    : false,        
	    scroll : {
	        items           : 1,
	        pauseOnHover    : true
	    },
			prev	: {	
				button	: ".fornecedores-carousel-prev",
				key		: "left"
			},
			next	: { 
				button	: ".fornecedores-carousel-next",
				key		: "right"
			}

	});

	$('.projects-carousel').carouFredSel({
	    items               : 3,
			auto						    : false,        
	    scroll : {
	        items           : 1,
	        pauseOnHover    : true
	    },
			prev	: {	
				button	: ".projects-carousel-prev",
				key		: "left"
			},
			next	: { 
				button	: ".projects-carousel-next",
				key		: "right"
			}

	});

	$('.news-carousel').carouFredSel({
	    items               : 4,
			auto						    : false,        
	    scroll : {
	        items           : 1,
	        pauseOnHover    : true
	    },
			prev	: {	
				button	: ".news-carousel-prev",
				key		: "left"
			},
			next	: { 
				button	: ".news-carousel-next",
				key		: "right"
			}

	}); 		

	/* INICIO ALTERACAO */
	$('.affiliates-carousel li a, .affiliates-list li a').on('click',function(e){
	/* FIM ALTERACAO */
		$('.modal-carousel').trigger('slideToPage', parseInt($(this).attr('data-index')-1));
	});

	$('.modal-carousel').carouFredSel({
			infinite:false,
			circular:false,
			width:780,
	    items               : 1,
			auto						    : false,        
	    scroll : {
	        items           : 1,
	        pauseOnHover    : true
	    },
			prev	: {	
				button	: ".modal-carousel-prev",
				key		: "left"
			},
			next	: { 
				button	: ".modal-carousel-next",
				key		: "right"
			}

	});
	
	/* INICIO ALTERACAO */
	$('.fornecedores-carousel li a, .fornecedores-list li a').on('click',function(e){
	/* FIM ALTERACAO */
		$('.fornecedores-modal-carousel').trigger('slideToPage', parseInt($(this).attr('data-index')-1));
	});

	$('.fornecedores-modal-carousel').carouFredSel({
			infinite:false,
			circular:false,
			width:780,
	    items               : 1,
			auto						    : false,        
	    scroll : {
	        items           : 1,
	        pauseOnHover    : true
	    },
			prev	: {	
				button	: ".fornecedores-modal-carousel-prev",
				key		: "left"
			},
			next	: { 
				button	: ".fornecedores-modal-carousel-next",
				key		: "right"
			}

	});
	
	$('section.expanded').removeClass('gray');
	$('section.expanded:even').addClass("gray");

	$('.bt-more-projects').on('click',function(e){
			e.preventDefault();

			$.ajax({
			  type: "POST",
			  url: BASE_URL + "projetos/acao/paging",
			  dataType: "json",
			  data:{offset:$(this).attr("offset")},
			  beforeSend:function(){
			  	console.log('LOADING....');
			  	$('.bt-more-projects span').html('carregando...');
			  },
			  success:function(data){
			  	for (var i = 0; i < data.projects.length; i++) {
			  		
			  		if(data.projects[i].image == '')
			  			$('.projects-list').append('<li class="col-2 center"><a href="'+__live+"/projetos/acao/detalhe/id/"+data.projects[i].id+'"><h3>'+data.projects[i].nome+'</h3><p>'+data.projects[i].texto+'</p></a></li>');
			  		else
						$('.projects-list').append('<li class="col-2 center"><a href="'+__live+"/projetos/acao/detalhe/id/"+data.projects[i].id+'"><img src="'+data.projects[i].marca+'"><h3>'+data.projects[i].nome+'</h3><p>'+data.projects[i].texto+'</p></a></li>');
					if(!((i+1)%3))
		  				$('.projects-list').append("<div class='clearfix'></div>");
			  	}

			  	$('.bt-more-projects span').html('mais projetos');

			  	if(data.remaining - data.projects.length) {
			  		$('.bt-more-projects span').html('mais projetos');
			  		$('.bt-more-projects').attr("offset",parseInt($('.bt-more-projects').attr("offset"))+6);
			  	} else {
			  		$('.bt-more-projects').remove();
			  	}

			  }
			});		

	});
	
	$('.bt-more-news').on('click',function(e){
		e.preventDefault();

		$.ajax({
		  type: "POST",
		  url: BASE_URL + "noticias/acao/paging",
		  dataType: "json",
		  data:{offset:$(this).attr("offset")},
		  beforeSend:function(){
		  	console.log('LOADING....');
		  	$('.bt-more-news span').html('carregando...');
		  },
		  success:function(data){
		  	for (var i = 0; i < data.news.length; i++) {
		  		
		  		if(data.news[i].image == '')
		  			$('.projects-list').append('<li class="col-2 center"><a href="'+__live+"/noticias/acao/detalhe/id/"+data.news[i].id+'"><h3>'+data.news[i].nome+'</h3><p>'+data.news[i].texto+'</p></a></li>');
		  		else
					$('.projects-list').append('<li class="col-2 center"><a href="'+__live+"/noticias/acao/detalhe/id/"+data.news[i].id+'"><img src="'+data.news[i].marca+'"><h3>'+data.news[i].nome+'</h3><p>'+data.news[i].texto+'</p></a></li>');
				if(!((i+1)%3))
	  				$('.projects-list').append("<div class='clearfix'></div>");
		  	}

		  	$('.bt-more-news span').html('mais notícias');

		  	if(data.remaining - data.news.length) {
		  		$('.bt-more-news span').html('mais notícias');
		  		$('.bt-more-news').attr("offset",parseInt($('.bt-more-news').attr("offset"))+6);
		  	} else {
		  		$('.bt-more-news').remove();
		  	}

		  }
		});		

});
	
	/* INICIO ADICAO */
	$('.bt-more-affiliates').on('click',function(e){
		e.preventDefault();

		$.ajax({
		  type: "POST",
		  url: BASE_URL + "associados/acao/paging",
		  data:{offset:$(this).attr("offset")},
		  dataType:"json",
		  beforeSend:function(){
		  	$('.bt-more-affiliates span').html('carregando...');
		  },
		  success:function(data){
			$('.added').removeClass('added');
		  	$('.modal-carousel').unbind('carouFredSel');
		  	for (var i = 0; i < data.affiliates.length; i++) {
		  		
		  		$('.affiliates-list')
		  		.append(
		  				'<li class="col-2 center"><a href="#" class="added" data-reveal-id="ModalAssociados" data-index="'+(1+i+parseInt($('.bt-more-affiliates').attr("offset")))+'"><img src="'+data.affiliates[i].marca+'"/><h3>'+data.affiliates[i].nome+'</h3></a></li>');
		  		
		  		$('.modal-carousel')
		  		.append(
		  				'<li>'+
	                    '<div class="col-text">'+
	                    '<h2>'+data.affiliates[i].nome+'</h2>'+
	                        '<ul class="project-data">'+
	                            '<li>Categoria:<span>'+data.affiliates[i].categoria+'</span></li>'+
	                        '</ul>'+
	                        '<p>'+data.affiliates[i].descricao+'</p>'+
	                        '<h3>Contato</h3>'+
	                        '<p>'+data.affiliates[i].contato+'<br/>'+data.affiliates[i].contato_email+'<br/>'+data.affiliates[i].contato_telefone+' </p>'+
	                        data.affiliates[i].nome+
	                        '<map value="'+data.affiliates[i].coordenadas+'" width="500" height="116">'+
	                    '</div>'+
	                    '<div class="col-img">'+
	                        '<img src="'+data.affiliates[i].marca+'">'+
	                        '<h3>Projetos:</h3>'+
	                        data.affiliates[i].projetos+
	                    '</div>'+
	                '</li>');
		  	}
		  	if(data.remaining - data.affiliates.length) {
			  	$('.bt-more-affiliates span').html('mais associados');
			  	$('.bt-more-affiliates').attr("offset",parseInt($('.bt-more-affiliates').attr("offset"))+6);
		  	} else {
		  		$('.bt-more-affiliates').remove();
		  	}
		  	processMaps();
		  	$('.added').on('click', function(e) {
		  		e.preventDefault();
		  		var modalLocation = $(this).attr('data-reveal-id');
		  		$('#'+modalLocation).reveal($(this).data());
	  		}); 
		  	
		  	$('.added').on('click',function(e){
		  		/* FIM ALTERACAO */
		  			$('.modal-carousel').trigger('slideToPage', parseInt($(this).attr('data-index')-1));
	  		});
		  	
		  	$('.modal-carousel').carouFredSel({
					infinite:false,
					circular:false,
					width:780,
					height:350,
			    items               : 1,
					auto						    : false,        
			    scroll : {
			        items           : 1,
			        pauseOnHover    : true
			    },
					prev	: {	
						button	: ".modal-carousel-prev",
						key		: "left"
					},
					next	: { 
						button	: ".modal-carousel-next",
						key		: "right"
					}
			});
		  }
		});		

	});
	/* FIM ALTERACAO */
	
	$('.bt-more-events').on('click',function(e){
		e.preventDefault();

		$.ajax({
		  type: "POST",
		  url: BASE_URL + "eventos/acao/paging",
		  data:{offset:$(this).attr("offset"), data:$(this).attr("data")},
		  dataType:"json",
		  beforeSend:function(){
		  	$('.bt-more-events span').html('carregando...');
		  },
		  success:function(data){
			$('.added').removeClass('added');
		  	$('.modal-carousel').unbind('carouFredSel');
		  	for (var i = 0; i < data.events.length; i++) {
		  		
		  		if(data.events[i].image == '')
		  			$('.projects-list').append('<li class="col-2 center"><a href="'+__live+"/eventos/acao/detalhe/id/"+data.events[i].id+'"><h3>'+data.events[i].nome+'</h3><p>'+data.events[i].texto+'</p></a></li>');
		  		else
					$('.projects-list').append('<li class="col-2 center"><a href="'+__live+"/eventos/acao/detalhe/id/"+data.events[i].id+'"><img src="'+data.events[i].marca+'"><h3>'+data.events[i].nome+'</h3><p>'+data.events[i].texto+'</p></a></li>');
				if(!((i+1)%3))
	  				$('.projects-list').append("<div class='clearfix'></div>");
		  	}
		  	if(data.remaining - data.events.length) {
			  	$('.bt-more-events span').html('mais eventos');
			  	$('.bt-more-events').attr("offset",parseInt($('.bt-more-events').attr("offset"))+6);
		  	} else {
		  		$('.bt-more-events').remove();
		  	}
		  	processMaps();
		  	$('.added').on('click', function(e) {
		  		e.preventDefault();
		  		var modalLocation = $(this).attr('data-reveal-id');
		  		$('#'+modalLocation).reveal($(this).data());
	  		}); 
		  	
		  	$('.added').on('click',function(e){
		  		/* FIM ALTERACAO */
		  			$('.modal-carousel').trigger('slideToPage', parseInt($(this).attr('data-index')-1));
	  		});
		  	
		  	$('.modal-carousel').carouFredSel({
					infinite:false,
					circular:false,
					width:780,
					height:350,
			    items               : 1,
					auto						    : false,        
			    scroll : {
			        items           : 1,
			        pauseOnHover    : true
			    },
					prev	: {	
						button	: ".modal-carousel-prev",
						key		: "left"
					},
					next	: { 
						button	: ".modal-carousel-next",
						key		: "right"
					}
			});
		  }
		});		

	});
	
	
	$('.bt-more-fornecedores').on('click',function(e){
		e.preventDefault();

		$.ajax({
		  type: "POST",
		  url: BASE_URL + "fornecedores/acao/paging",
		  data:{offset:$(this).attr("offset")},
		  dataType:"json",
		  beforeSend:function(){
		  	$('.bt-more-fornecedores span').html('carregando...');
		  },
		  success:function(data){
			$('.added').removeClass('added');
		  	$('.modal-carousel').unbind('carouFredSel');
		  	for (var i = 0; i < data.affiliates.length; i++) {
		  		
		  		$('.affiliates-list')
		  		.append(
		  				'<li class="col-2 center"><a href="#" class="added" data-reveal-id="ModalAssociados" data-index="'+(1+i+parseInt($('.bt-more-fornecedores').attr("offset")))+'"><img src="'+data.fornecedor[i].marca+'"/><h3>'+data.fornecedor[i].nome+'</h3></a></li>');
		  		
		  		$('.modal-carousel')
		  		.append(
		  				'<li>'+
	                    '<div class="col-text">'+
	                    '<h2>'+data.fornecedor[i].nome+'</h2>'+
	                        '<ul class="project-data">'+
	                            '<li>Categoria:<span>'+data.fornecedor[i].categoria+'</span></li>'+
	                        '</ul>'+
	                        '<p>'+data.fornecedor[i].descricao+'</p>'+
	                        '<h3>Contato</h3>'+
	                        '<p>'+data.fornecedor[i].contato+'<br/>'+data.fornecedor[i].contato_email+'<br/>'+data.fornecedor[i].contato_telefone+' </p>'+
	                        data.fornecedor[i].nome+
	                        '<map value="'+data.fornecedor[i].coordenadas+'" width="500" height="116">'+
	                    '</div>'+
	                    '<div class="col-img">'+
	                        '<img src="'+data.fornecedor[i].marca+'">'+
	                        '<h3>Projetos:</h3>'+
	                        data.fornecedor[i].projetos+
	                    '</div>'+
	                '</li>');
		  	}
		  	if(data.remaining - data.fornecedor.length) {
			  	$('.bt-more-fornecedores span').html('mais fornecedores');
			  	$('.bt-more-fornecedores').attr("offset",parseInt($('.bt-more-fornecedores span').attr("offset"))+6);
		  	} else {
		  		$('.bt-more-fornecedores').remove();
		  	}
		  	processMaps();
		  	$('.added').on('click', function(e) {
		  		e.preventDefault();
		  		var modalLocation = $(this).attr('data-reveal-id');
		  		$('#'+modalLocation).reveal($(this).data());
	  		}); 
		  	
		  	$('.added').on('click',function(e){
		  		/* FIM ALTERACAO */
		  			$('.modal-carousel').trigger('slideToPage', parseInt($(this).attr('data-index')-1));
	  		});
		  	
		  	$('.modal-carousel').carouFredSel({
					infinite:false,
					circular:false,
					width:780,
					height:350,
			    items               : 1,
					auto						    : false,        
			    scroll : {
			        items           : 1,
			        pauseOnHover    : true
			    },
					prev	: {	
						button	: ".modal-carousel-prev",
						key		: "left"
					},
					next	: { 
						button	: ".modal-carousel-next",
						key		: "right"
					}
			});
		  }
		});		

	});

	$('a.anchorLink').on('click',function(){
		$('a.anchorLink').parent().removeClass('active');
		$(this).parent().addClass('active');

	});

	$(".calendar-widget").eventCalendar({
		monthNames:['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
		dayNamesShort: ['D','S','T','Q','Q','S','S'],
		eventsjson: BASE_URL + 'json/acao/eventos' // link to events json
	});
	
	$('.zebrado:even').addClass("gray");

//affiliates-carousel
	
	$('.affiliates-carousel li a, .affiliates-list li a').on('click',function(e){
		$('.modal-carousel').trigger('slideToPage', parseInt($(this).attr('data-index')-1));
	});

	$('.cd-link').on('click', function() {
		$('#download-categoria').text($(this).text());
		$('#link-area').html("Carregando...");
		
		$.ajax({
			url:__live+"/json/acao/download/",
			data: {"id":$(this).attr("data-id")},
			dataType:"json",
			type:"POST",
			success: function(data) {
				$('#link-area').html("");
				for(var i = 0; i < data.length;i++) {
	           		var linha = 
	           		'<div class="zebrado-download '+ (i%2==0 ? 'gray' : '')+'">' +
	           			'<a href="'+data[i].url+'" >'+data[i].nome+'</a>' +
	           		'</div>';
	        		$('#link-area').append(linha);
				}
			}
		});
	});
	
});



$(document).ready(function() {
 	var location = window.location.href;
	if(location.indexOf("#") !== -1) {
		window.scrollTo(0,0);
		var last = location.split("#")[1];
		if(last && last.length != 0)
			$("a[href='#"+last+"']").trigger('click');
	}
});

//MENU DE ACORDO COM A ROLAGEM
// Cache selectors
var lastId,
    topMenu = $("#top-menu"),
    topMenuHeight = topMenu.outerHeight()+65,
    // All list items
    menuItems = topMenu.find("li a"),
    // Anchors corresponding to menu items
    scrollItems = menuItems.map(function(){
      var item = $($(this).attr("href"));
      if (item.length) { return item; }
    });

// Bind to scroll
$(window).scroll(function(){
   // Get container scroll position
   var fromTop = $(this).scrollTop()+topMenuHeight;
   
   // Get id of current scroll item
   var cur = scrollItems.map(function(){
     if ($(this).offset().top < fromTop)
       return this;
   });
   // Get the id of the current element
   cur = cur[cur.length-1];
   var id = '';
   
   if(fromTop < 3000){

			id = cur && cur.length ? cur[0].id : "";

	   if (lastId !== id) {
	       lastId = id;
	       // Set/remove active class
	       menuItems
	         .parent().removeClass("active")
	         .end().filter("[href=#"+id+"]").parent().addClass("active");
	   }

 	 }else{

	       menuItems
	         .parent().removeClass("active")
	         .end().filter("[href=#contato]").parent().addClass("active"); 	 		
 	 }                
});
